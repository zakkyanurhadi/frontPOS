<!doctype html>
<html class="light" lang="id">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>RST POS - Keranjang</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#800000",
              "primary-dark": "#5e0000",
              secondary: "#333333",
              "background-light": "#f8f6f6",
              "background-dark": "#1a1a1a",
              "card-light": "#ffffff",
              "card-dark": "#2d2d2d",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
            },
            borderRadius: {
              xl: "12px",
              "2xl": "16px",
              "3xl": "24px",
            },
            boxShadow: {
              soft: "0 4px 20px -2px rgba(0, 0, 0, 0.05)",
              card: "0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.1)",
            },
          },
        },
      };
    </script>
    <style>
      body {
        min-height: 100vh;
        padding-bottom: env(safe-area-inset-bottom);
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .toggle-checkbox:checked {
        left: calc(100% - 1.25rem);
      }
      .toggle-checkbox:checked + .toggle-label {
        background-color: #800000;
        border-color: #800000;
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
          transform: scale(1);
        }
        to {
          opacity: 0;
          transform: scale(0.9);
        }
      }
      .fade-out {
        animation: fadeOut 0.3s ease-out forwards;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }
      .shake {
        animation: shake 0.3s ease-in-out;
      }
      /* Scanner Overlay */
      .scanner-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 9999;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .scanner-overlay.active {
        display: flex;
      }
      .scanner-frame {
        position: relative;
        width: 280px;
        height: 280px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 24px;
        overflow: hidden;
      }
      .scanner-frame::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, transparent, #800000, transparent);
        animation: scan 2s linear infinite;
      }
      @keyframes scan {
        0% {
          top: 0;
        }
        50% {
          top: calc(100% - 3px);
        }
        100% {
          top: 0;
        }
      }
      .scanner-corner {
        position: absolute;
        width: 30px;
        height: 30px;
        border-color: #800000;
        border-width: 4px;
      }
      .scanner-corner.top-left {
        top: -2px;
        left: -2px;
        border-top-style: solid;
        border-left-style: solid;
        border-radius: 12px 0 0 0;
      }
      .scanner-corner.top-right {
        top: -2px;
        right: -2px;
        border-top-style: solid;
        border-right-style: solid;
        border-radius: 0 12px 0 0;
      }
      .scanner-corner.bottom-left {
        bottom: -2px;
        left: -2px;
        border-bottom-style: solid;
        border-left-style: solid;
        border-radius: 0 0 0 12px;
      }
      .scanner-corner.bottom-right {
        bottom: -2px;
        right: -2px;
        border-bottom-style: solid;
        border-right-style: solid;
        border-radius: 0 0 12px 0;
      }
    </style>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-100 flex flex-col relative overflow-x-hidden antialiased"
  >
    <!-- Fixed Top Section (Header + Search) - Combined to avoid gap -->
    <div class="fixed top-0 left-0 right-0 z-50">
      <!-- Header -->
      <header class="bg-white dark:bg-card-dark h-14">
        <div class="px-4 h-full flex items-center justify-between relative">
          <!-- Tombol Kembali (Kiri) -->
          <a
            href="buat_transaksi.html"
            class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-white/10 text-gray-900 dark:text-white transition-colors z-10"
          >
            <span class="material-symbols-outlined">arrow_back</span>
          </a>

          <!-- Judul (Tengah Absolut) -->
          <h1
            class="absolute left-1/2 -translate-x-1/2 text-base font-bold text-gray-900 dark:text-white tracking-tight"
          >
            Keranjang
          </h1>

          <!-- Placeholder untuk keseimbangan (Kanan) -->
          <div class="w-10 h-10"></div>
        </div>
      </header>

      <!-- Search Section -->
      <div
        class="bg-background-light dark:bg-background-dark border-b border-gray-200/50 dark:border-gray-700/50 shadow-sm"
      >
        <div class="max-w-md mx-auto px-4 py-3">
          <!-- Search Bar with Scanner -->
          <div
            class="relative group shadow-sm rounded-xl bg-white dark:bg-card-dark border border-gray-200/50 dark:border-gray-700/50"
          >
            <div
              class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none"
            >
              <span
                class="material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors"
                >search</span
              >
            </div>
            <input
              id="searchInput"
              class="block w-full pl-11 pr-14 py-3 rounded-xl bg-transparent text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all text-sm font-medium"
              placeholder="Cari item di keranjang..."
              type="text"
            />
            <!-- Scan Barcode Button -->
            <div class="absolute inset-y-0 right-0 pr-2 flex items-center">
              <button
                id="btnOpenScanner"
                class="relative p-2.5 rounded-xl bg-gradient-to-br from-primary to-primary-dark text-white shadow-lg shadow-primary/30 hover:shadow-primary/50 transition-all duration-300 hover:scale-105 active:scale-95"
                title="Scan Barcode Produk"
              >
                <span class="material-symbols-outlined text-[22px]"
                  >barcode_scanner</span
                >
                <!-- Efek pulse -->
                <span
                  class="absolute inset-0 rounded-xl bg-primary/20 animate-ping"
                ></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Spacer untuk fixed top section -->
    <div class="h-[130px]"></div>

    <!-- Main Content -->
    <main class="flex-1 w-full pb-60">
      <div class="px-4 space-y-4">
        <!-- Header Section -->
        <div class="flex items-center justify-between px-1">
          <h2
            class="text-sm font-semibold text-gray-500 uppercase tracking-wider"
          >
            Item Dipesan
          </h2>
          <span
            id="itemCountBadge"
            class="text-xs font-medium text-primary bg-primary/10 px-2 py-1 rounded-md"
          >
            0 Item
          </span>
        </div>

        <!-- Cart Items Container -->
        <div id="cartItemsContainer" class="space-y-3">
          <!-- Items will be rendered by JavaScript -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden py-12 text-center">
          <span class="material-symbols-outlined text-gray-300 text-5xl mb-3"
            >shopping_cart</span
          >
          <p class="text-gray-500 text-sm mb-4">Keranjang masih kosong</p>
          <a
            href="buat_transaksi.html"
            class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-xl text-sm font-semibold hover:bg-primary-dark transition-colors"
          >
            <span class="material-symbols-outlined text-[18px]">add</span>
            Tambah Produk
          </a>
        </div>

        <!-- Tambah Item Button -->
        <a
          href="buat_transaksi.html"
          id="addMoreBtn"
          class="group w-full py-3.5 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl text-gray-600 dark:text-gray-400 font-semibold flex items-center justify-center gap-2 hover:bg-gray-50 dark:hover:bg-white/5 hover:border-primary/50 hover:text-primary transition-all active:scale-[0.99]"
        >
          <div
            class="w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 group-hover:bg-primary group-hover:text-white flex items-center justify-center transition-colors text-gray-500"
          >
            <span class="material-symbols-outlined text-[16px]">add</span>
          </div>
          Tambah Item Lain
        </a>

        <!-- Diskon & Pajak -->
        <div class="grid grid-cols-1 gap-3">
          <div
            class="bg-white dark:bg-card-dark rounded-xl px-4 py-3 flex items-center justify-between border border-gray-100 dark:border-gray-700/50 shadow-sm"
          >
            <div class="flex items-center gap-3">
              <div
                class="w-9 h-9 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600 dark:text-blue-400 shrink-0"
              >
                <span class="material-symbols-outlined text-[18px]"
                  >percent</span
                >
              </div>
              <div class="flex flex-col">
                <span class="text-sm font-bold text-gray-900 dark:text-white"
                  >Diskon</span
                >
                <span id="discountDisplay" class="text-xs text-gray-500"
                  >Potongan harga</span
                >
              </div>
            </div>
            <button
              id="discountBtn"
              class="text-xs font-semibold text-blue-700 bg-blue-50 dark:bg-blue-900/30 dark:text-blue-300 px-3 py-1.5 rounded-lg border border-blue-100 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors"
            >
              Tambah
            </button>
          </div>
          <div
            class="bg-white dark:bg-card-dark rounded-xl px-4 py-3 flex items-center justify-between border border-gray-100 dark:border-gray-700/50 shadow-sm"
          >
            <div class="flex items-center gap-3">
              <div
                class="w-9 h-9 rounded-full bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 dark:text-purple-400 shrink-0"
              >
                <span class="material-symbols-outlined text-[18px]"
                  >receipt_long</span
                >
              </div>
              <div class="flex flex-col">
                <span class="text-sm font-bold text-gray-900 dark:text-white"
                  >Pajak</span
                >
                <span class="text-xs text-gray-500">PPN 11%</span>
              </div>
            </div>
            <div
              class="relative inline-block w-11 h-6 align-middle select-none transition duration-200 ease-in"
            >
              <input
                class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-none appearance-none cursor-pointer top-1 left-1 checked:left-[22px] transition-all duration-300 z-10"
                id="taxToggle"
                name="toggle"
                type="checkbox"
              />
              <label
                class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-200 dark:bg-gray-700 cursor-pointer checked:bg-primary transition-colors duration-300 border border-gray-200 dark:border-gray-600"
                for="taxToggle"
              ></label>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Fixed Bottom Summary -->
    <div
      class="fixed bottom-0 left-0 w-full bg-white dark:bg-card-dark border-t border-gray-200 dark:border-gray-700 shadow-[0_-8px_30px_rgba(0,0,0,0.08)] z-50 rounded-t-3xl"
    >
      <div class="px-5 pt-4 pb-8">
        <div class="space-y-2.5 mb-5">
          <div
            class="flex justify-between text-sm text-gray-600 dark:text-gray-400"
          >
            <span>Subtotal (<span id="subtotalCount">0</span> Item)</span>
            <span
              id="subtotalDisplay"
              class="font-medium text-gray-900 dark:text-white tabular-nums"
              >Rp 0</span
            >
          </div>
          <div
            id="taxRow"
            class="flex justify-between text-sm text-gray-600 dark:text-gray-400 hidden"
          >
            <span>Pajak (11%)</span>
            <span
              id="taxDisplay"
              class="font-medium text-gray-900 dark:text-white tabular-nums"
              >Rp 0</span
            >
          </div>
          <div
            id="discountRow"
            class="flex justify-between text-sm text-blue-600 dark:text-blue-400 hidden"
          >
            <span>Diskon</span>
            <span id="discountAmountDisplay" class="font-medium tabular-nums"
              >- Rp 0</span
            >
          </div>

          <div class="h-px bg-gray-100 dark:bg-gray-700 my-2"></div>
          <div class="flex justify-between items-center">
            <span class="text-base font-bold text-gray-900 dark:text-white"
              >Total Tagihan</span
            >
            <span
              id="totalDisplay"
              class="text-xl font-bold text-primary tabular-nums"
              >Rp 0</span
            >
          </div>
        </div>
        <a
          id="checkoutBtn"
          href="metode_pembayaran.html"
          class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-4 rounded-2xl shadow-lg shadow-primary/30 active:scale-[0.98] transition-all flex items-center justify-between px-6 group disabled:opacity-50"
        >
          <div class="flex flex-col items-start">
            <span
              class="text-xs font-medium text-white/80 uppercase tracking-wider"
              >Total</span
            >
            <span id="btnTotalDisplay" class="text-lg font-bold">Rp 0</span>
          </div>
          <div
            class="flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-lg group-hover:bg-white/20 transition-colors"
          >
            <span class="text-sm font-semibold">Pilih Pembayaran</span>
            <span class="material-symbols-outlined text-[18px]"
              >arrow_forward</span
            >
          </div>
        </a>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      // Data produk dummy (bisa dari localStorage jika ada)
      const defaultProducts = [
        {
          id: 1,
          name: "Kopi Susu Gula Aren",
          price: 18000,
          note: "Normal Sugar, Less Ice",
          image:
            "https://lh3.googleusercontent.com/aida-public/AB6AXuBaGcJ9y4yhzrMVHpOzbAbX8xEQvAUcwL2elnTIilFhHk6UAqquXx0EzMs4z4gduMfi0ttlntCDuw5sIQtR9oCt-uN2fOCZjOxspsgF1J8U9Ez96Yx_ngIpNRRZ4OhZrPI3t703jO3xV1XvEAY7zaVHjKIcJsl5MwKu2d7tqBsE2E4b_4p8DPpdpjq-tAwNZZrI_CcI1Ab_bHLCwVKP1IDR9oemuVpMDJwTS2jarLf_abrfPkeInuUoFvLrzjiZAIclW8NdiRJrNCA",
        },
        {
          id: 2,
          name: "Burger Spesial",
          price: 35000,
          note: "Extra Cheese",
          image:
            "https://lh3.googleusercontent.com/aida-public/AB6AXuBfeBbtgUGukGROHCK3Hr5rC5KHv0iXLftEC-_5aTchlYDuxLZLnoPf9LEsCxJW58hKTqyFi7aZEL4QGp41K6CdYtqmBscbD-64baNAjEYKrFPdnxL3ZmFZVq8TA2-F0AS2ygHcKw7ksZ0CZicZJk5OhJ69B9T04MIDN1jJ3ANqCtWwKLoTVwt-Zy2P0xO0a1CTQHVxDrO7TTBFgHayC-hbNUYwrZW--BpcxoCfBpfFvFV2pBuZsnBywedJM4r50yAjJ1xTmWhWdeU",
        },
      ];

      // State
      let cartItems = [];
      let discountPercent = 0;
      let taxEnabled = false;

      // Format Rupiah
      function formatRupiah(num) {
        return "Rp " + num.toLocaleString("id-ID");
      }

      // Parse angka dari input
      function parseNumber(str) {
        return parseInt(str.replace(/\D/g, "")) || 0;
      }

      // Inisialisasi cart
      function initCart() {
        // Coba ambil dari localStorage
        const savedCart = localStorage.getItem("cartItems");
        if (savedCart) {
          cartItems = JSON.parse(savedCart);
        } else {
          // Gunakan data default dengan quantity
          cartItems = defaultProducts.map((p) => ({ ...p, qty: 1 }));
        }
        renderCart();
        updateTotals();
      }

      // Simpan cart ke localStorage
      function saveCart() {
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
      }

      // Render cart items
      function renderCart() {
        const container = document.getElementById("cartItemsContainer");
        const emptyState = document.getElementById("emptyState");
        const addMoreBtn = document.getElementById("addMoreBtn");
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();

        let filteredItems = cartItems;
        if (searchTerm) {
          filteredItems = cartItems.filter((item) =>
            item.name.toLowerCase().includes(searchTerm),
          );
        }

        if (cartItems.length === 0) {
          container.innerHTML = "";
          emptyState.classList.remove("hidden");
          addMoreBtn.classList.add("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        addMoreBtn.classList.remove("hidden");

        if (filteredItems.length === 0) {
          container.innerHTML = `
            <div class="py-8 text-center">
              <span class="material-symbols-outlined text-gray-300 text-4xl mb-2">search_off</span>
              <p class="text-gray-500 text-sm">Item tidak ditemukan</p>
            </div>
          `;
          return;
        }

        container.innerHTML = filteredItems
          .map(
            (item) => `
          <div class="cart-item bg-white dark:bg-card-dark rounded-2xl p-3 shadow-card border border-gray-100 dark:border-gray-700/50 overflow-hidden relative" data-id="${
            item.id
          }">
            <div class="flex gap-3">
              <div class="w-20 h-20 rounded-xl overflow-hidden shrink-0 bg-gray-100 relative">
                <img alt="${
                  item.name
                }" class="w-full h-full object-cover" src="${item.image}" />
              </div>
              <div class="flex-1 flex flex-col justify-between py-0.5">
                <div>
                  <h3 class="text-base font-bold text-gray-900 dark:text-white leading-tight line-clamp-2">${
                    item.name
                  }</h3>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${
                    item.note || ""
                  }</p>
                </div>
                <div class="flex justify-between items-end mt-2">
                  <span class="text-sm font-bold text-primary">${formatRupiah(
                    item.price * item.qty,
                  )}</span>
                </div>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-50 dark:border-gray-700 flex items-center justify-between">
              <button onclick="deleteItem(${
                item.id
              })" class="w-8 h-8 flex items-center justify-center rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                <span class="material-symbols-outlined text-[20px]">delete</span>
              </button>
              <div class="flex items-center gap-2 bg-gray-50 dark:bg-gray-800 rounded-lg p-1">
                <button onclick="updateQty(${
                  item.id
                }, -1)" class="w-8 h-8 flex items-center justify-center rounded-md bg-white dark:bg-gray-700 shadow-sm text-gray-600 dark:text-gray-300 active:scale-95 transition-transform border border-gray-200 dark:border-gray-600 hover:text-red-500">
                  <span class="material-symbols-outlined text-[18px]">remove</span>
                </button>
                <span class="font-bold text-gray-900 dark:text-white w-6 text-center tabular-nums">${
                  item.qty
                }</span>
                <button onclick="updateQty(${
                  item.id
                }, 1)" class="w-8 h-8 flex items-center justify-center rounded-md bg-primary text-white shadow-sm shadow-primary/30 active:scale-95 transition-transform hover:bg-primary-dark">
                  <span class="material-symbols-outlined text-[18px]">add</span>
                </button>
              </div>
            </div>
          </div>
        `,
          )
          .join("");
      }

      // Update quantity
      function updateQty(id, delta) {
        const item = cartItems.find((i) => i.id === id);
        if (!item) return;

        item.qty += delta;
        if (item.qty <= 0) {
          deleteItem(id);
          return;
        }

        saveCart();
        renderCart();
        updateTotals();
      }

      // Delete item
      function deleteItem(id) {
        const itemEl = document.querySelector(`.cart-item[data-id="${id}"]`);
        if (itemEl) {
          itemEl.classList.add("fade-out");
          setTimeout(() => {
            cartItems = cartItems.filter((i) => i.id !== id);
            saveCart();
            renderCart();
            updateTotals();
          }, 300);
        } else {
          cartItems = cartItems.filter((i) => i.id !== id);
          saveCart();
          renderCart();
          updateTotals();
        }
      }

      // Update all totals
      function updateTotals() {
        let subtotal = 0;
        let totalQty = 0;

        cartItems.forEach((item) => {
          subtotal += item.price * item.qty;
          totalQty += item.qty;
        });

        // Calculate tax
        const tax = taxEnabled ? Math.round(subtotal * 0.11) : 0;

        // Calculate discount
        const discount = Math.round((subtotal * discountPercent) / 100);

        // Final total
        const total = subtotal + tax - discount;

        // Update displays
        document.getElementById("itemCountBadge").textContent =
          `${totalQty} Item`;
        document.getElementById("subtotalCount").textContent = totalQty;
        document.getElementById("subtotalDisplay").textContent =
          formatRupiah(subtotal);

        // Tax row
        const taxRow = document.getElementById("taxRow");
        if (taxEnabled) {
          taxRow.classList.remove("hidden");
          document.getElementById("taxDisplay").textContent = formatRupiah(tax);
        } else {
          taxRow.classList.add("hidden");
        }

        // Discount row
        const discountRow = document.getElementById("discountRow");
        if (discountPercent > 0) {
          discountRow.classList.remove("hidden");
          document.getElementById("discountAmountDisplay").textContent =
            `- ${formatRupiah(discount)}`;
        } else {
          discountRow.classList.add("hidden");
        }

        // Total
        document.getElementById("totalDisplay").textContent =
          formatRupiah(total);
        document.getElementById("btnTotalDisplay").textContent =
          formatRupiah(total);

        // Enable/disable checkout
        const checkoutBtn = document.getElementById("checkoutBtn");
        if (total <= 0) {
          checkoutBtn.style.opacity = "0.5";
          checkoutBtn.style.pointerEvents = "none";
        } else {
          checkoutBtn.style.opacity = "1";
          checkoutBtn.style.pointerEvents = "auto";
        }
      }

      // Tax toggle
      document.getElementById("taxToggle").addEventListener("change", (e) => {
        taxEnabled = e.target.checked;
        updateTotals();
      });

      // Discount button
      document.getElementById("discountBtn").addEventListener("click", () => {
        const input = prompt(
          "Masukkan persentase diskon (0-100):",
          discountPercent,
        );
        if (input !== null) {
          const value = parseInt(input) || 0;
          discountPercent = Math.min(100, Math.max(0, value));

          const discountDisplay = document.getElementById("discountDisplay");
          if (discountPercent > 0) {
            discountDisplay.textContent = `${discountPercent}% off`;
            document.getElementById("discountBtn").textContent = "Ubah";
          } else {
            discountDisplay.textContent = "Potongan harga";
            document.getElementById("discountBtn").textContent = "Tambah";
          }
          updateTotals();
        }
      });

      // Search
      document.getElementById("searchInput").addEventListener("input", () => {
        renderCart();
      });

      // Initialize
      initCart();
    </script>

    <!-- Barcode Scanner Overlay -->
    <div id="scannerOverlay" class="scanner-overlay">
      <div
        class="w-full px-6 flex justify-between items-center absolute top-0 pt-12 pb-4"
      >
        <button
          id="btnCloseScanner"
          class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20 transition-colors"
        >
          <span class="material-symbols-outlined text-[28px]">close</span>
        </button>
        <h2 class="text-white font-bold text-lg">Scan Barcode</h2>
        <button
          id="btnToggleFlash"
          class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20 transition-colors"
        >
          <span class="material-symbols-outlined text-[24px]">flash_off</span>
        </button>
      </div>

      <div class="scanner-frame">
        <video
          id="cameraPreview"
          autoplay
          playsinline
          class="w-full h-full object-cover"
        ></video>
        <div class="scanner-corner top-left"></div>
        <div class="scanner-corner top-right"></div>
        <div class="scanner-corner bottom-left"></div>
        <div class="scanner-corner bottom-right"></div>
      </div>

      <div class="mt-8 text-center">
        <p class="text-white/70 text-sm">Arahkan kamera ke barcode produk</p>
        <p class="text-white/50 text-xs mt-2">
          Produk akan otomatis ditambahkan ke keranjang
        </p>
      </div>

      <div class="absolute bottom-0 w-full pb-12 pt-6 px-6">
        <div class="text-center text-white/60 text-xs">
          <span class="material-symbols-outlined text-[16px] align-middle mr-1"
            >info</span
          >
          Scanner otomatis mendeteksi barcode
        </div>
      </div>
    </div>

    <!-- Scanner Script -->
    <script>
      let stream = null;
      let flashEnabled = false;
      const scannerOverlay = document.getElementById("scannerOverlay");
      const cameraPreview = document.getElementById("cameraPreview");
      const btnOpenScanner = document.getElementById("btnOpenScanner");
      const btnCloseScanner = document.getElementById("btnCloseScanner");
      const btnToggleFlash = document.getElementById("btnToggleFlash");

      // Demo: Daftar produk dengan barcode (dalam implementasi nyata, fetch dari API)
      const daftarProduk = [
        { barcode: "8991234567890", nama: "Nasi Goreng Spesial", harga: 25000 },
        { barcode: "8997654321098", nama: "Mie Ayam Bakso", harga: 20000 },
        { barcode: "8998765432109", nama: "Es Teh Manis", harga: 5000 },
        { barcode: "8999876543210", nama: "Ayam Geprek", harga: 18000 },
      ];

      // Cari produk berdasarkan barcode
      function findProductByBarcode(barcode) {
        return daftarProduk.find((p) => p.barcode === barcode);
      }

      // Tambah produk dari scan ke keranjang
      function addScannedProductToCart(product) {
        const existingIndex = cartItems.findIndex(
          (item) => item.barcode === product.barcode,
        );

        if (existingIndex >= 0) {
          cartItems[existingIndex].qty += 1;
        } else {
          cartItems.push({
            id: Date.now(),
            barcode: product.barcode,
            name: product.nama,
            price: product.harga,
            qty: 1,
            notes: "",
          });
        }

        saveCart();
        renderCart();
        updateTotals();
      }

      // Open Scanner
      btnOpenScanner.addEventListener("click", async () => {
        try {
          stream = await navigator.mediaDevices.getUserMedia({
            video: {
              facingMode: "environment",
              width: { ideal: 1280 },
              height: { ideal: 720 },
            },
          });
          cameraPreview.srcObject = stream;
          scannerOverlay.classList.add("active");
          document.body.style.overflow = "hidden";

          // Simulasi auto-scan setelah 2 detik (demo)
          setTimeout(() => {
            if (scannerOverlay.classList.contains("active")) {
              simulateScan();
            }
          }, 2000);
        } catch (err) {
          console.error("Error accessing camera:", err);
          alert(
            "Tidak dapat mengakses kamera. Pastikan Anda memberikan izin akses kamera.",
          );
        }
      });

      // Simulasi scan otomatis
      function simulateScan() {
        const scannedBarcode = "8991234567890"; // Demo barcode
        const product = findProductByBarcode(scannedBarcode);

        if (product) {
          addScannedProductToCart(product);
          closeScanner();

          // Visual feedback
          const container = document.getElementById("cartItemsContainer");
          container.classList.add("shake");
          setTimeout(() => container.classList.remove("shake"), 300);
        }
      }

      // Close Scanner
      function closeScanner() {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          stream = null;
        }
        cameraPreview.srcObject = null;
        scannerOverlay.classList.remove("active");
        document.body.style.overflow = "";
        flashEnabled = false;
        btnToggleFlash.querySelector("span").textContent = "flash_off";
      }

      btnCloseScanner.addEventListener("click", closeScanner);

      // Toggle Flash
      btnToggleFlash.addEventListener("click", async () => {
        if (!stream) return;

        const track = stream.getVideoTracks()[0];
        const capabilities = track.getCapabilities();

        if (capabilities.torch) {
          flashEnabled = !flashEnabled;
          await track.applyConstraints({
            advanced: [{ torch: flashEnabled }],
          });
          btnToggleFlash.querySelector("span").textContent = flashEnabled
            ? "flash_on"
            : "flash_off";
        } else {
          alert("Flash tidak tersedia pada perangkat ini");
        }
      });

      // Close on escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && scannerOverlay.classList.contains("active")) {
          closeScanner();
        }
      });
    </script>
  </body>
</html>
